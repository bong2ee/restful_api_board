<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="common/header"></head>	<!-- 헤더 인클루드 -->
<body class="hold-transition layout-top-nav">
<div class="wrapper">
	
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0">회원 로그인</h1>
          </div>
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <div class="content">
      <div class="container">
        
		<div class="card card-primary">
          <!-- /.card-header -->
          <!-- form start -->
          <form name="frm" id="frm">
            <div class="card-body">
              <div class="form-group">
                <label for="exampleInputEmail1">아이디</label>
                <input type="text" class="form-control" id="memberId" name="memberId" placeholder="아이디를 입력해주세요">
              </div>
              <div class="form-group">
                <label for="exampleInputPassword1">비밀번호</label>
                <input type="password" class="form-control" id="password" name="password" placeholder="비밀번호를 입력해주세요">
              </div>
            </div>
            <!-- /.card-body -->

            <div class="card-footer">
			  <button type="button" class="btn btn-outline-dark" onclick="location.href='/signup'";>회원가입</button>
              <button type="button" id="signinButton" class="btn btn-outline-primary float-right">로그인</button>
            </div>
          </form>
        </div>
			
        <!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  </div>
  
  <script>
      $('#signinButton').on('click', function() {
        if (!validateForm()) {
          return false;
        }

        signin();
      });

      function validateForm() {
        if ($('#memberId').val() === "") {
          alert("아이디가 입력되지 않았습니다.");
          return false;
        }

        if ($('#password').val() === "") {
          alert("비밀번호가 입력되지 않았습니다.");
          return false;
        }

        return true;
      }

      function signin() {
      let data2 = { 
  		memberId: $('#memberId').val(),
  		password: $('#password').val() 
	  };
        
	  let frm = $('#frm');
      let formData = new FormData(frm.get(0));

      // FormData를 일반 객체로 변환
      let data = {};
      formData.forEach((value, key) => {
          data[key] = value;
      });
	  //console.log(data)
	  
	  $.ajax({
	      url: '/api/member/signin', 
	      type: 'POST',
	      contentType: 'application/json',  // 전송 데이터 형식
	      dataType: 'json',  // 응답 데이터 형식
	      data: JSON.stringify(data),  // JSON 형식으로 데이터 변환
	      success: function(response) {
			  alert(response.message);
			  if (response.status === 'success') {
	              location.href = "/";
	          } 
	      },
	      error: function(xhr, status, error) {
	          console.error('Error:', error); 
			  alert("서버 오류가 발생했습니다. 나중에 다시 시도해주세요.");
	      }
	  });
  					  
      }
    </script>
  </body>
  <!-- 푸터 인클루드 -->
  <footer th:replace="common/footer"></footer>
  </html>